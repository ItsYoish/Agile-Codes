<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaAlert Database Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #0066cc;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background: #f9f9f9;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            display: inline-block;
            background: #0066cc;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background: #0055aa;
        }
        .btn-danger {
            background: #cc3300;
        }
        .btn-danger:hover {
            background: #aa2200;
        }
        .btn-success {
            background: #33cc66;
        }
        .btn-success:hover {
            background: #22aa44;
        }
        pre {
            background: #f1f1f1;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .status-active { background: #d4edda; color: #155724; }
        .status-maintenance { background: #fff3cd; color: #856404; }
        .status-deployed { background: #cce5ff; color: #004085; }
        .status-standby { background: #e2e3e5; color: #383d41; }
    </style>
</head>
<body>
    <div class="container">
        <h1>AquaAlert Database Test</h1>
        
        <div class="card">
            <h2>Database Operations</h2>
            <button id="loadBtn" class="btn">Load Data</button>
            <button id="resetBtn" class="btn btn-danger">Reset to Sample Data</button>
            <button id="clearBtn" class="btn btn-danger">Clear All Data</button>
            <button id="addBowserBtn" class="btn btn-success">Add Test Bowser</button>
        </div>
        
        <div class="card">
            <h2>Bowsers</h2>
            <div id="bowsersContainer" class="grid"></div>
        </div>
        
        <div class="card">
            <h2>Locations</h2>
            <div id="locationsContainer" class="grid"></div>
        </div>
        
        <div class="card">
            <h2>Maintenance Records</h2>
            <div id="maintenanceContainer" class="grid"></div>
        </div>
        
        <div class="card">
            <h2>Raw Database Content</h2>
            <pre id="dbContent"></pre>
        </div>
    </div>

    <script type="module">
        import dbHandler from './js/db-handler.js';
        
        // DOM elements
        const loadBtn = document.getElementById('loadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const clearBtn = document.getElementById('clearBtn');
        const addBowserBtn = document.getElementById('addBowserBtn');
        const bowsersContainer = document.getElementById('bowsersContainer');
        const locationsContainer = document.getElementById('locationsContainer');
        const maintenanceContainer = document.getElementById('maintenanceContainer');
        const dbContent = document.getElementById('dbContent');
        
        // Load data and render
        async function loadAndRender() {
            try {
                await dbHandler.loadData();
                renderData();
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading data: ' + error.message);
            }
        }
        
        // Render all data
        function renderData() {
            renderBowsers();
            renderLocations();
            renderMaintenance();
            renderRawData();
        }
        
        // Render bowsers
        function renderBowsers() {
            const bowsers = dbHandler.getBowsers();
            bowsersContainer.innerHTML = '';
            
            if (bowsers.length === 0) {
                bowsersContainer.innerHTML = '<p>No bowsers found</p>';
                return;
            }
            
            bowsers.forEach(bowser => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${bowser.number}</h3>
                    <p><strong>Capacity:</strong> ${bowser.capacity}L</p>
                    <p><strong>Current Level:</strong> ${bowser.currentLevel}L</p>
                    <p><strong>Status:</strong> <span class="status status-${bowser.status}">${bowser.status}</span></p>
                    <p><strong>Owner:</strong> ${bowser.owner}</p>
                    <p><strong>Last Maintenance:</strong> ${bowser.lastMaintenance}</p>
                    <p><strong>Notes:</strong> ${bowser.notes}</p>
                    <button class="btn btn-danger delete-bowser" data-id="${bowser.id}">Delete</button>
                `;
                bowsersContainer.appendChild(card);
                
                // Add event listener for delete button
                card.querySelector('.delete-bowser').addEventListener('click', async () => {
                    if (confirm(`Are you sure you want to delete bowser ${bowser.number}?`)) {
                        await dbHandler.deleteBowser(bowser.id);
                        renderData();
                    }
                });
            });
        }
        
        // Render locations
        function renderLocations() {
            const locations = dbHandler.getLocations();
            locationsContainer.innerHTML = '';
            
            if (locations.length === 0) {
                locationsContainer.innerHTML = '<p>No locations found</p>';
                return;
            }
            
            locations.forEach(location => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${location.name}</h3>
                    <p><strong>Address:</strong> ${location.address}</p>
                    <p><strong>Type:</strong> ${location.type}</p>
                    <p><strong>Status:</strong> ${location.status}</p>
                    <p><strong>Bowser ID:</strong> ${location.bowserId || 'None'}</p>
                `;
                locationsContainer.appendChild(card);
            });
        }
        
        // Render maintenance records
        function renderMaintenance() {
            const records = dbHandler.getMaintenanceRecords();
            maintenanceContainer.innerHTML = '';
            
            if (records.length === 0) {
                maintenanceContainer.innerHTML = '<p>No maintenance records found</p>';
                return;
            }
            
            records.forEach(record => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>Maintenance #${record.id}</h3>
                    <p><strong>Bowser ID:</strong> ${record.bowserId}</p>
                    <p><strong>Date:</strong> ${record.date}</p>
                    <p><strong>Type:</strong> ${record.type}</p>
                    <p><strong>Description:</strong> ${record.description}</p>
                    <p><strong>Technician:</strong> ${record.technician}</p>
                    <p><strong>Cost:</strong> Â£${record.cost}</p>
                    <p><strong>Status:</strong> ${record.status}</p>
                `;
                maintenanceContainer.appendChild(card);
            });
        }
        
        // Render raw data
        function renderRawData() {
            dbContent.textContent = JSON.stringify(dbHandler.data, null, 2);
        }
        
        // Add a test bowser
        async function addTestBowser() {
            const newBowser = {
                number: `WB-TEST-${Math.floor(Math.random() * 1000)}`,
                capacity: 6000,
                currentLevel: 6000,
                status: 'active',
                manufacturer: 'Test Manufacturer',
                model: 'Test Model',
                lastMaintenance: new Date().toISOString().split('T')[0],
                nextMaintenance: new Date(new Date().setMonth(new Date().getMonth() + 2)).toISOString().split('T')[0],
                owner: 'Test Region',
                notes: 'This is a test bowser'
            };
            
            await dbHandler.addBowser(newBowser);
            renderData();
        }
        
        // Reset to sample data
        async function resetToSampleData() {
            if (confirm('Are you sure you want to reset to sample data? This will delete all current data.')) {
                localStorage.removeItem(dbHandler.DB_KEY);
                await dbHandler.loadSampleData();
                renderData();
            }
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                localStorage.removeItem(dbHandler.DB_KEY);
                dbHandler.data = { bowsers: [], locations: [], maintenance: [] };
                dbHandler.dataLoaded = true;
                dbHandler.saveData();
                renderData();
            }
        }
        
        // Event listeners
        loadBtn.addEventListener('click', loadAndRender);
        resetBtn.addEventListener('click', resetToSampleData);
        clearBtn.addEventListener('click', clearAllData);
        addBowserBtn.addEventListener('click', addTestBowser);
        
        // Initial load
        loadAndRender();
    </script>
</body>
</html>
